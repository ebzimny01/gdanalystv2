{% extends "gdanalyst/layout.html" %}
{% load static %}

{% block title %}
    GD Analyst
{% endblock %}

{% block body %}
    <div class="h3" id="gameresultsjobid"></div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
{% if job_id %}
    <script>
        var jobUrl = "{% url 'jobstatus' jobid=job_id %}";
        var dots = 1;
        var progressTitle = document.getElementById('gameresultsjobid');
        updateProgressTitle();
        var timer = setInterval(function() {
            updateProgressTitle();
            axios.get(jobUrl)
                .then(function(response){
                    var jobStatus = response.data
                    if (jobStatus === 'finished') {
                        clearTimer('Finished loading game results');
                        window.location.replace("{% url 'display_game_results' jobid=job_id %}");
                    } else if (jobStatus === 'failed') {
                    clearTimer('An error occurred');
                    }
                })
                .catch(function(err){
                    console.log('err', err);
                    clearTimer('An error occurred');
                });
            }, 800);

        function updateProgressTitle() {
            dots++;
            if (dots > 3) {
            dots = 1;
            }
            progressTitle.innerHTML = 'Loading game results ';
            for (var i = 0; i < dots; i++) {
            progressTitle.innerHTML += '.';
            }
        }
        function clearTimer(message) {
            clearInterval(timer);
            progressTitle.innerHTML = message;
        }
    </script>
{% endif %}
{% endblock %}
